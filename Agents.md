# Repurpuzai

## Project Overview

Repurpuzai is a content repurposing application that automatically converts YouTube videos into well-structured blog posts and Twitter threads using AI. The app extracts video transcripts, processes them with Google's Gemini AI, and generates professional content in multiple formats. Users can edit generated content using a rich text editor, manage their content library, and repurpose their video content efficiently.

## Tech Stack

- **Language**: TypeScript
- **Framework**: Next.js 16 with App Router (React 19)
- **Package Manager**: npm
- **Database**: Neon PostgreSQL with Drizzle ORM
- **AI**: Google Gemini 2.5 Flash (`@google/genai`)
- **Authentication**: Better Auth (email/password with email verification)
- **Styling**: Tailwind CSS 4 with shadcn/ui components
- **Rich Text Editor**: TipTap with extensive extensions
- **Email**: Resend for transactional emails
- **Linting/Formatting**: Biome (via Ultracite)
- **Build Tool**: Turbopack

## Project Structure

```
/
├── app/                    # Next.js App Router pages and API routes
│   ├── api/                # API endpoints (auth, generate, youtube, blog, waitlist)
│   ├── content/            # Content editor and viewer pages
│   ├── library/            # User's content library
│   └── [auth-pages]/       # Login, signup, forgot-password, etc.
├── components/             # React components
│   ├── forms/              # Form components (main-form, login, signup, etc.)
│   ├── emails/             # Email templates (verification, password reset)
│   ├── ui/                 # shadcn/ui components
│   └── [feature-components] # Blog editor, video cards, etc.
├── server/                 # Server actions (marked with "use server")
│   ├── ai.ts               # AI content generation logic
│   ├── blogs.ts            # Blog/content CRUD operations
│   └── users.ts            # User management functions
├── lib/                    # Utility functions and helpers
│   ├── auth.ts             # Better Auth configuration
│   ├── youtube.ts          # YouTube data extraction utilities
│   ├── markdown-to-html.ts # Markdown conversion utilities
│   └── utils.ts            # General utilities
├── db/                     # Database configuration
│   ├── schema.ts           # Drizzle ORM schema definitions
│   └── drizzle.ts          # Database connection setup
├── migrations/             # Database migration files (generated by Drizzle)
└── public/                 # Static assets

```

## Key Components

- **AI Content Generation** (`server/ai.ts`): Handles YouTube transcript extraction, AI prompt creation, and parallel generation of blog posts and Twitter threads using Gemini 2.5 Flash. Includes transcript analysis, content validation, and error handling.

- **Content Management** (`server/blogs.ts`): Manages blog and thread content in the database. Handles CRUD operations, content grouping by video ID, and supports both blog and thread content types stored in the same table.

- **YouTube Integration** (`lib/youtube.ts`): Extracts video metadata, transcripts, and captions from YouTube URLs. Handles URL cleaning, video ID extraction, and integrates with YouTube Data API v3 and caption extraction libraries.

- **Rich Text Editor** (`components/tiptap-editor.tsx`): TipTap-based WYSIWYG editor with extensive extensions (tables, code blocks, markdown shortcuts, etc.). Supports editing both blog and thread content with real-time preview.

- **Content Editor** (`app/content/[videoId]/content-editor.tsx`): Main content editing interface that allows users to switch between blog and thread views, edit content, and save changes. Includes sidebar navigation and content preview.

- **Authentication System** (`lib/auth.ts`): Better Auth integration with email/password authentication, email verification, password reset, and session management. Uses Resend for transactional emails.

## Development Workflow

### Setup
```bash
# Install dependencies
npm install

# Set up environment variables (create .env.local)
# Required variables:
# - DATABASE_URL (Neon PostgreSQL connection string)
# - GEMINI_API_KEY (Google Gemini API key)
# - RESEND_API_KEY (Resend email service key)
# - NEXT_PUBLIC_APP_URL (App URL for auth callbacks)
# - EMAIL_SENDER_NAME (Email sender name)
# - EMAIL_SENDER_ADDRESS (Email sender address)

# Set up database
npx drizzle-kit generate
npx drizzle-kit migrate
```

### Running the Project
```bash
# Development mode (with Turbopack)
npm run dev

# Build for production
npm run build

# Start production server
npm start
```

### Type Checking / Linting
```bash
# Lint and check code quality (Biome)
npm run lint

# Format code (Biome)
npm run format
```

## Important Context Documents

When working on specific tasks, you may need to reference these documents:

- `AUTH_SYSTEM.md` - Authentication system implementation details, Better Auth configuration, email setup, and production deployment checklist
- `GEMINI_SETUP.md` - Google Gemini API setup guide, API key configuration, cost information, and troubleshooting
- `EMAIL_DEBUGGING_GUIDE.md` - Email debugging and testing guide for development
- `reverting.md` - Comprehensive guide for reverting changes, recovering from mistakes, restoring deleted files, and going back to stable states. Essential for beginners learning Git.
- `README.md` - General project overview, features, and setup instructions

**Before starting work, review relevant documents above based on your task.**

## Critical Notes

- **Content Types**: The app supports two content types (`blog` and `thread`) stored in the same `blogs` table. Content is grouped by video ID using slug patterns (`{videoId}-blog` and `{videoId}-thread`).

- **AI Generation**: The AI generation process uses a two-step approach: (1) Analyze transcript with chunked data, (2) Generate both content types in parallel. This ensures efficient API usage and consistent content quality.

- **Transcript Requirements**: Videos MUST have captions (auto-generated or manual) for content generation to work. The system validates caption availability before processing.

- **Content Validation**: Generated content must meet minimum length requirements (500+ chars for blogs, 280+ chars for threads). The system includes hallucination detection indicators.

- **Database Schema**: Uses Drizzle ORM with PostgreSQL. Key tables: `user`, `blogs`, `session`, `account`, `verification`, `waitlist`. Blogs table uses `contentType` enum to distinguish between blog and thread content.

- **Authentication**: Email verification is REQUIRED for new users. Password reset uses email tokens. Sessions are managed server-side with Better Auth.

- **Editor State**: TipTap editor content is stored in two formats: `content` (HTML string) and `tiptapContent` (JSON). Both are updated when users edit content.

- **YouTube URL Handling**: The system handles various YouTube URL formats (youtube.com, youtu.be, with/without timestamps, etc.) and extracts video IDs consistently.

- **Error Handling**: All server actions use try-catch blocks and throw descriptive errors. API routes validate input with Zod schemas before processing.

## Getting Help

- **Documentation**: Check root-level `.md` files for detailed guides (AUTH_SYSTEM.md, GEMINI_SETUP.md, etc.)
- **Examples**: Look for similar implementations in `server/` for server action patterns, `components/` for UI patterns, and `app/api/` for API route patterns
- **Context**: When unsure, search the codebase for existing patterns before implementing new approaches. The codebase follows consistent patterns for error handling, type safety, and component structure